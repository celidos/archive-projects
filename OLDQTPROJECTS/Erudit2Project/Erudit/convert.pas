unit convert;

interface

uses
  SysUtils, Forms;

type
  TForm1 = class(TForm)
    procedure FormCreate(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

  Type ShortString=string[16];

     WorkFieldType= record
	     main:char; { ??????? ???? }
	     available:boolean; { ???? "?????????????" ??????}
	     hotspot:char; { "???-????" ????????}
	     color:byte; {???? ??????}
	     forChoice:char; { ???? ???? ?????? }
             Image:-1..224; { ????? ????? ? ?????? }
             Checked:boolean; { ???? ????????????? ?????? ?????}
                     end;
     Slot7Type=record
		Letter:char; { ????? ? ?????? ????? }
		SlotX:word; { ?????????? ? ?????? ????? }
		SlotY:word; { ?????????? Y ?????? ????? }
		Mark:boolean; { ??????? ?? ?????? }
                Image:-1..224; { ????? ????? ? ?????? }
               end;

     PlayersType=record
                      Name:string[9];
                      Points:word;
                      Changes:byte;
                      Image:string[8];
                      Code:byte;
                    end;

     WordListTypeOld=record
                      Word:string[15];
                      WBegin,WEnd:1..15;
                      Coord:1..15;
                      Direction:1..2;
                   end;

     WordListTypeNew=record
                      Word:string[15];
                      WBegin,WEnd:1..15;
                      Coord:1..15;
                      Direction:1..2;
                      Value:byte;
                   end;

     SaveFileTypeNew=record
                        Date:string[10]; { ???? ?????????? }
                        Time:string[20]; { ????? ??????????}
                        Info:string[150]; { ?????????? ? ?????? }
                        Opnt:0..1; { ??? ????????? }
                        Intellect:1..4; { ??? ??????????  }
                        Limits:string[20]; { ??????????? }
                        Themes:string[20]; { ???? }
                        ElaspedGameTime1:string[7]; { ????? ?????? }
                        ElaspedGameTime2:string[7]; { ????? ?????? }
                        StartHour,StartMin,StartSec:word;
                        WorkField:array[0..16,0..16] of WorkFieldType; { ??????? ???? }
                        Players:array[1..4] of PlayersType; { ?????? }
                        WordList:array[1..100,1..4] of WordListTypeNew;
                        Slot7:array[1..4,1..7] of Slot7Type; { ??????? ????? }
                        Move:1..4; { ??? ???? }
                        Help:boolean; { ???? ????????? }
                        Mode:12..14; { ????? ???????? ???????? }
                        Letters:array[0..224] of record { ????? }
                                                 Left:integer;
                                                 Top:integer;
                                                 Hint:string[255];
                                                 Tag:integer;
                                                 Visible:Boolean;
                                                 end;
                        ChoiceFieldStatus:boolean; { "?????????" ???? ?????? }
                        GoButStatus:array[1..2] of boolean; { "?????????" ???????? "????!" }
                        ChButStatus:array[1..2] of boolean; { "?????????" ???????? "?????!" }
                        QVButStatus:boolean; { "?????????" ???????? "??????? ??????" }
                        HpButStatus:boolean; { "?????????" ???????? "?????????" }
                        Reserved3:boolean; { ???? ?????? ???? ?? ????? ???? ?????????? }
                        Reserved2:boolean; { ???? ?????? ?? ????? ???????? ?????? }
                        Reserved1:boolean; { ???? ?????? ???????? ?????? }
                        Reserved0:boolean; { ???? ?????? ??????????? }
                        HintDelay:0..1000; {????? ?????????}
                        HintLimit:byte; {?????????? ?????????? ?????????}
                        StoreHintLimit:byte; {????? ?????????? ???????? }
                      end;


    SaveFileTypeOld=record
                        Date:string[10]; { ???? ?????????? }
                        Time:string[20]; { ????? ??????????}
                        Info:string[150]; { ?????????? ? ?????? }
                        Opnt:0..1; { ??? ????????? }
                        Intellect:1..4; { ??? ??????????  }
                        Limits:string[20]; { ??????????? }
                        Themes:string[20]; { ???? }
                        ElaspedGameTime1:string[7]; { ????? ?????? }
                        ElaspedGameTime2:string[7]; { ????? ?????? }
                        StartHour,StartMin,StartSec:word;
                        WorkField:array[0..16,0..16] of WorkFieldType; { ??????? ???? }
                        Players:array[1..4] of PlayersType; { ?????? }
                        WordList:array[1..50,1..4] of WordListTypeOld;
                        PlacedWordList:array[1..4] of string[255];
                        Slot7:array[1..4,1..7] of Slot7Type; { ??????? ????? }
                        Move:1..4; { ??? ???? }
                        Help:boolean; { ???? ????????? }
                        Mode:12..14; { ????? ???????? ???????? }
                        Letters:array[0..224] of record { ????? }
                                                 Left:integer;
                                                 Top:integer;
                                                 Hint:string[255];
                                                 Tag:integer;
                                                 Visible:Boolean;
                                                 end;
                        ChoiceFieldStatus:boolean; { "?????????" ???? ?????? }
                        GoButStatus:array[1..2] of boolean; { "?????????" ???????? "????!" }
                        ChButStatus:array[1..2] of boolean; { "?????????" ???????? "?????!" }
                        QVButStatus:boolean; { "?????????" ???????? "??????? ??????" }
                        HpButStatus:boolean; { "?????????" ???????? "?????????" }
                        InfoLines:array[1..3] of string[100]; { ?????????????? ??????? }
                        ShowClearedWords:boolean; { ???? ?????? ???? ?? ????? ???? ?????????? }
                        ShowHintButtons:boolean; { ???? ?????? ?? ????? ???????? ?????? }
                        ShowHintMarkers:boolean; { ???? ?????? ???????? ?????? }
                        ShowTerminals:boolean; { ???? ?????? ??????????? }
                        HintDelay:0..1000; {????? ?????????}
                        HintLimit:byte; {?????????? ?????????? ?????????}
                        StoreHintLimit:byte; {????? ??????????}
                                 end;



var
  Form1: TForm1;

implementation

{$R *.dfm}

procedure TForm1.FormCreate(Sender: TObject);
var OldFile:file of SaveFileTypeOld;
    NewFile:file of SaveFileTypeNew;
    OldSave:SaveFileTypeOld;
    NewSave:SaveFileTypeNew;
    sr:TSearchRec;
    I,J:byte;
begin
   if FindFirst('save???.*', 0, sr) = 0 Then
repeat
   If sr.size=70064 Then
   begin
   AssignFile(OldFile, sr.Name);
//   try
   Reset(OldFile);
   Read(OldFile, OldSave);
   CloseFile(OldFile);

   NewSave.Date:=OldSave.Date;
   NewSave.Time:=OldSave.Time;
   NewSave.Info:=OldSave.Info;
   NewSave.Opnt:=OldSave.Opnt;
   NewSave.Intellect:=OldSave.Intellect;
   NewSave.Limits:=OldSave.Limits;
   NewSave.Themes:=OldSave.Themes;
   NewSave.ElaspedGameTime1:=OldSave.ElaspedGameTime1;
   NewSave.ElaspedGameTime2:=OldSave.ElaspedGameTime2;
   NewSave.StartHour:=OldSave.StartHour;
   NewSave.StartMin:=OldSave.StartMin;
   NewSave.StartSec:=OldSave.StartSec;
   for I:=0 to 16 do For J:=0 To 16 do
    NewSave.WorkField[I,J]:=OldSave.Workfield[I,J];
   for I:=1 to 4 do
    NewSave.Players[I]:=OldSave.Players[I];
   for I:=1 to 50 do For J:=1 To 4 do begin
    NewSave.WordList[I,J].Word:=OldSave.WordList[I,J].Word;
    NewSave.WordList[I,J].WBegin:=OldSave.WordList[I,J].Wbegin;
    NewSave.WordList[I,J].WEnd:=OldSave.WordList[I,J].WEnd;
    NewSave.WordList[I,J].Coord:=OldSave.WordList[I,J].Coord;
    NewSave.WordList[I,J].Direction:=OldSave.WordList[I,J].Direction;
    NewSave.WordList[I,J].Value:=0;
                                      end;
   for I:=51 to 100 do For J:=1 To 4 do begin
    NewSave.WordList[I,J].Word:='';
                                      end;
   for I:=1 to 4 do For J:=1 To 7 do
    NewSave.Slot7[I,J]:=OldSave.Slot7[I,J];
   NewSave.Move:=OldSave.Move;
   NewSave.Help:=OldSave.Help;
   NewSave.Mode:=OldSave.Mode;
   for I:=0 to 224 do begin
    NewSave.Letters[I].Left:=OldSave.Letters[I].Left;
    NewSave.Letters[I].Top:=OldSave.Letters[I].Top;
    NewSave.Letters[I].Hint:=OldSave.Letters[I].Hint;
    NewSave.Letters[I].Tag:=OldSave.Letters[I].Tag;
    NewSave.Letters[I].Visible:=OldSave.Letters[I].Visible;
                      end;
   NewSave.ChoiceFieldStatus:=OldSave.ChoiceFieldStatus;
   for I:=1 to 2 do begin
    NewSave.GoButStatus[I]:=OldSave.GoButStatus[I];
    NewSave.ChButStatus[I]:=OldSave.ChButStatus[I];
                    end;
   NewSave.QVButStatus:=OldSave.QVButStatus;
   NewSave.HpButStatus:=OldSave.HpButStatus;
   NewSave.HintDelay:=OldSave.HintDelay;
   NewSave.HintLimit:=OldSave.HintLimit;
   NewSave.StoreHintLimit:=NewSave.StoreHintLimit;

   AssignFile(NewFile, sr.Name);
   ReWrite(NewFile);
   Write(NewFile, NewSave);
   CloseFile(NewFile);
   end;
//   except end;
until FindNext(sr)<>0;
halt;
end;

end.
